geom_point(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom") +
scale_shape_discrete(guide = "none")
table(pred_plot_all2$sanatorium)
pred_plot_all2 <- form_comb$pred_comb %>%
left_join(studyid) %>%
arrange(desc(enrollment_start)) %>%
mutate(first_author = factor(first_author, levels = unique(first_author)),
time_period = ifelse(is.na(time_period), "", time_period),
location = ifelse(is.na(location), "", location),
location = factor(location, levels = c("North America",
"Europe", "")))
pred_plot_all2 <- form_comb$pred_comb %>%
left_join(studyid) %>%
arrange(desc(enrollment_start)) %>%
mutate(first_author = factor(first_author, levels = unique(first_author)),
location = ifelse(is.na(location), "", location),
location = factor(location, levels = c("North America",
"Europe", "")))
# Forest plot for combined model, no coloring
ggplot(pred_plot_all2 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub,
shape = shape, color = sanatorium)) +
facet_grid(location ~ pred_label, scales = "free", space = "free") +
geom_point() +
geom_point(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom") +
scale_shape_discrete(guide = "none")
# Forest plot for combined model, no coloring
ggplot(pred_plot_all2 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub,
shape = shape, color = sanatorium)) +
facet_grid(location ~ pred_label, scales = "free", space = "free") +
geom_point() +
geom_point(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
scale_color_discrete(na.translate = FALSE) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom") +
scale_shape_discrete(guide = "none")
# Forest plot for combined model, no coloring
ggplot(pred_plot_all2 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub,
shape = shape)) +
facet_grid(location ~ pred_label, scales = "free", space = "free") +
geom_point(aes(color = sanatorium)) +
geom_point(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
scale_color_discrete(na.translate = FALSE) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom") +
scale_shape_discrete(guide = "none")
# Forest plot for combined model, no coloring
ggplot(pred_plot_all2 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
facet_grid(location ~ pred_label, scales = "free", space = "free") +
geom_point(aes(color = sanatorium)) +
geom_point(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
scale_color_discrete(na.translate = FALSE) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom") +
scale_shape_discrete(guide = "none")
# Forest plot for combined model, no coloring
ggplot(pred_plot_all2 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
facet_grid(location ~ pred_label, scales = "free", space = "free") +
geom_point(aes(color = sanatorium)) +
geom_point(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(aes(color = sanatorium), width = 0.5) +
geom_errorbar(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom") +
scale_shape_discrete(guide = "none")
# Forest plot for combined model, no coloring
ggplot(pred_plot_all2 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
facet_grid(location ~ pred_label, scales = "free", space = "free") +
geom_point(aes(color = sanatorium)) +
geom_point(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(aes(color = sanatorium), width = 0.5) +
geom_errorbar(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
scale_color_discrete(na.translate = FALSE) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom") +
scale_shape_discrete(guide = "none")
?shape_color_discrete
?scale_color_discrete
# Forest plot for combined model, no coloring
ggplot(pred_plot_all2 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
facet_grid(location ~ pred_label, scales = "free", space = "free") +
geom_point(aes(color = sanatorium)) +
geom_point(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(aes(color = sanatorium), width = 0.5) +
geom_errorbar(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
scale_color_discrete(name = "Treatment Location",
na.translate = FALSE, ) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom") +
scale_shape_discrete(guide = "none")
# Forest plot for combined model, no coloring
ggplot(pred_plot_all1 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
facet_grid(shape ~ pred_label, scales = "free", space = "free") +
geom_point() +
geom_point(data = pred_plot_all1 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom",
strip.text.y = element_blank()) +
scale_shape_discrete(guide = "none")
pred_plot_all1 <- form_comb$pred_comb %>%
arrange(desc(first_author)) %>%
mutate(first_author = factor(first_author, levels = unique(first_author)))
# Forest plot for combined model, no coloring
ggplot(pred_plot_all1 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
facet_grid(shape ~ pred_label, scales = "free", space = "free") +
geom_point() +
geom_point(data = pred_plot_all1 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom",
strip.text.y = element_blank()) +
scale_shape_discrete(guide = "none")
pred_plot_time <- bind_rows(form_pre$pred_comb, form_post$pred_comb) %>%
group_by(label) %>%
arrange(desc(first_author)) %>%
mutate(first_author = factor(first_author, levels = unique(first_author))) %>%
mutate(labelf = ifelse(shape == "Overall" & label == "Pre-1930", " ",
ifelse(shape == "Overall" & label == "Post-1930", "  ",
label)),
labelf = factor(labelf, levels = c("Pre-1930", " ", "Post-1930", "  ")))
pred_plot_loc <- bind_rows(form_namerica$pred_comb, form_europe$pred_comb) %>%
group_by(label) %>%
arrange(desc(first_author)) %>%
mutate(first_author = factor(first_author, levels = unique(first_author))) %>%
mutate(labelf = ifelse(shape == "Overall" & label == "North America", " ",
ifelse(shape == "Overall" & label == "Europe", "  ",
label)),
labelf = factor(labelf, levels = c("North America", " ", "Europe", "  ")))
pred_plot_san <- bind_rows(form_yessan$pred_comb, form_nosan$pred_comb) %>%
group_by(label) %>%
arrange(desc(first_author)) %>%
mutate(first_author = factor(first_author, levels = unique(first_author))) %>%
mutate(labelf = ifelse(shape == "Overall" & label == "Sanatorium/hospital", " ",
ifelse(shape == "Overall" & label == "Non-Sanatorium", "  ",
label)),
labelf = factor(labelf, levels = c("Sanatorium/hospital", " ",
"Non-Sanatorium", "  ")))
plot_forest <- function(pred_plot){
p <- ggplot(pred_plot %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
geom_point() +
geom_point(data = pred_plot %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
facet_grid(labelf ~ pred_label, scales = "free", space = "free") +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom") +
scale_shape_discrete(guide = "none")
return(p)
}
p_time <- plot_forest(pred_plot_time)
plot_forest(pred_plot_time)
# Forest plot for combined model, no coloring
ggplot(pred_plot_all2 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
facet_grid(location ~ pred_label, scales = "free", space = "free") +
geom_point(aes(color = sanatorium)) +
geom_point(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(aes(color = sanatorium), width = 0.5) +
geom_errorbar(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
scale_color_discrete(name = "Treatment Location",
na.translate = FALSE, ) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom")
# Forest plot for combined model, no coloring
ggplot(pred_plot_all2 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
facet_grid(location ~ pred_label, scales = "free", space = "free") +
geom_point(aes(color = sanatorium)) +
geom_point(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(aes(color = sanatorium), width = 0.5) +
geom_errorbar(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
scale_color_discrete(name = "Treatment Location",
na.translate = FALSE, values = c("Sanatorium/hospital",
"Non-Sanatorium")) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom")
# Forest plot for combined model, no coloring
ggplot(pred_plot_all2 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
facet_grid(location ~ pred_label, scales = "free", space = "free") +
geom_point(aes(color = sanatorium)) +
geom_point(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(aes(color = sanatorium), width = 0.5) +
geom_errorbar(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
scale_color_discrete(name = "Treatment Location", na.translate = FALSE,
labels = c("Non-Sanatorium", "Sanatorium/hospital"))) +
# Forest plot for combined model, no coloring
ggplot(pred_plot_all2 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
facet_grid(location ~ pred_label, scales = "free", space = "free") +
geom_point(aes(color = sanatorium)) +
geom_point(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(aes(color = sanatorium), width = 0.5) +
geom_errorbar(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
scale_color_discrete(name = "Treatment Location", na.translate = FALSE,
labels = c("Non-Sanatorium", "Sanatorium/hospital")) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom")
# Forest plot for combined model, no coloring
ggplot(pred_plot_all2 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
facet_grid(location ~ pred_label, scales = "free", space = "free") +
geom_point(aes(color = sanatorium)) +
geom_point(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(aes(color = sanatorium), width = 0.5) +
geom_errorbar(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
width = 0.5) +
geom_hline(yintercept = 5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
scale_color_discrete(name = "Treatment Location", na.translate = FALSE,
labels = c("Non-Sanatorium", "Sanatorium/hospital")) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom")
# Forest plot for combined model, no coloring
ggplot(pred_plot_all2 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
facet_grid(location ~ pred_label, scales = "free", space = "free") +
geom_point(aes(color = sanatorium)) +
geom_point(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(aes(color = sanatorium), width = 0.5) +
geom_errorbar(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
width = 0.5) +
geom_hline(yintercept = 10) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
scale_color_discrete(name = "Treatment Location", na.translate = FALSE,
labels = c("Non-Sanatorium", "Sanatorium/hospital")) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom")
# Forest plot for combined model, no coloring
ggplot(pred_plot_all2 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
facet_grid(location ~ pred_label, scales = "free", space = "free") +
geom_point(aes(color = sanatorium)) +
geom_point(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(aes(color = sanatorium), width = 0.5) +
geom_errorbar(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
width = 0.5) +
geom_hline(yintercept = 6) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
scale_color_discrete(name = "Treatment Location", na.translate = FALSE,
labels = c("Non-Sanatorium", "Sanatorium/hospital")) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom")
# Forest plot for combined model, no coloring
ggplot(pred_plot_all2 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
geom_hline(yintercept = 6) +
facet_grid(location ~ pred_label, scales = "free", space = "free") +
geom_point(aes(color = sanatorium)) +
geom_point(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(aes(color = sanatorium), width = 0.5) +
geom_errorbar(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
scale_color_discrete(name = "Treatment Location", na.translate = FALSE,
labels = c("Non-Sanatorium", "Sanatorium/hospital")) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom")
ggplot(pred_plot_all2 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
geom_hline(yintercept = 6)
# Forest plot for combined model, no coloring
ggplot(pred_plot_all2 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
facet_grid(location ~ pred_label, scales = "free", space = "free") +
geom_point(aes(color = sanatorium)) +
geom_point(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(aes(color = sanatorium), width = 0.5) +
geom_errorbar(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
scale_color_discrete(name = "Treatment Location", na.translate = FALSE,
labels = c("Non-Sanatorium", "Sanatorium/hospital")) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom")
ggsave("Figures/forest_comb1.png", width = 6.5, height = 3.5)
ggsave("Figures/forest_comb2.png", width = 6.5, height = 3.5)
pred_plot_all1 <- form_comb$pred_comb %>%
arrange(desc(first_author)) %>%
mutate(first_author = factor(first_author, levels = unique(first_author)))
# Forest plot for combined model, no coloring
ggplot(pred_plot_all1 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
facet_grid(shape ~ pred_label, scales = "free", space = "free") +
geom_point() +
geom_point(data = pred_plot_all1 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom",
strip.text.y = element_blank())
ggsave("Figures/forest_comb1.png", width = 6.5, height = 3.5)
ggsave("Figures/forest_comb1.png", width = 6.5, height = 4)
# Forest plot for combined model, no coloring
ggplot(pred_plot_all1 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
facet_grid(shape ~ pred_label, scales = "free", space = "free") +
geom_point() +
geom_point(data = pred_plot_all1 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom",
strip.text.y = element_blank())
pred_plot_all2 <- form_comb$pred_comb %>%
left_join(studyid) %>%
arrange(desc(enrollment_start)) %>%
mutate(first_author = factor(first_author, levels = unique(first_author)),
location = ifelse(is.na(location), "", location),
location = factor(location, levels = c("North America",
"Europe", "")))
# Forest plot for combined model, no coloring
ggplot(pred_plot_all2 %>% filter(value != "median"),
aes(x = est, y = first_author, xmin = cilb, xmax = ciub)) +
facet_grid(location ~ pred_label, scales = "free", space = "free") +
geom_point(aes(color = sanatorium)) +
geom_point(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
color = 'black', shape = 18, size = 3) +
geom_errorbar(aes(color = sanatorium), width = 0.5) +
geom_errorbar(data = pred_plot_all2 %>% filter(shape == "Overall",
value != "median"),
width = 0.5) +
scale_x_continuous(name = "Survival Probability", limits = c(0, 1),
breaks = c(0, 0.5, 1)) +
scale_color_discrete(name = "Treatment Location", na.translate = FALSE,
labels = c("Non-Sanatorium", "Sanatorium/hospital")) +
theme_bw() +
theme(axis.title.y = element_blank(),
legend.position = "bottom")
ggsave("Figures/forest_comb2.png", width = 6.5, height = 4)
ggsave("Figures/forest_comb2.png", width = 6.5, height = 4.5)
4/5
pnorm(0.8)
6/5
pnorm(1.2)
0.885-0.788
pnorm(27, 21, 5)
pnorm(27, 21, 5)-pnorm(25, 21, 5)
21+0.675*5
qnorm(0.75, 21, 5)
3/(5/sqrt(30))
pnorm(3.29)
1-pnorm(3.29)
1-pnorm(3.3)
1-0.9988
2/(5/sqrt(30))
pnorm(2.19)
1-pnorm(2.19)
133/162
88/97
133/142
45/753
1.645*sqrt((0.0598*(1-0.0598))/753)
0.0598-0.0142
0.0598-+0.0142
0.0598+0.0142
0.060-0.101
sqrt((0.06*(1-0.06))/753)
-0.041/0.0087
0.288/0.151
(0.288/(1-0.288))/(0.151/(1-0.151))
0.288-0.151
((0.288)(1-0.288))/582
((0.288)(1-0.288))/582
(0.288 * (1-0.288))/582
(0.151 * (1-0.151))/933
1.96*sqrt(0.000352+0.000137)
0.137-0.043
0.137+0.043
1.96*sqrt((0.0598*(1-0.0598))/753)
0.0598-0.0169
0.0598+0.0169
